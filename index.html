<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<link href="styles.css" rel="stylesheet"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>自然大叔 ∣ 訂單排程系統</title>
<link href="https://res.cloudinary.com/dijzndzw2/image/upload/v1757176751/logo-3_hddq08.png" rel="icon" type="image/png"/>
<script defer="True" src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
.photo-url-input { width: 100%; max-width: 520px; margin-bottom: 4px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 6px; }
#photoUrlContainer .photo-row { display: flex; align-items: center; gap: 8px; }
#addPhotoUrlBtn.btn.btn-blue { background-color: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
#photoUrlViewer a { word-break: break-all; overflow-wrap: anywhere; display: block; }
</style>
</head>
<body>
<header id="scheduleHeader">
  <div class="wrap toolbar header-toolbar">
    <div class="header-item" data-header-id="yearMonth">
      <div class="pill">
        <strong>月份</strong>
        <select id="yearSel"><option value="自然大叔"></option></select>
        <select id="monthSel"></select>
      </div>
    </div>
    <div class="header-item" data-header-id="staff">
      <div class="pill">
        <strong>作業人員</strong>
        <select id="staffFilter"></select>
      </div>
    </div>
    <div class="header-item" data-header-id="status">
      <div class="pill">
        <strong>狀況</strong>
        <select id="statusFilter">
          <option value="">全部</option>
          <option value="排定">排定</option>
          <option value="完成">完成</option>
          <option value="未完成">未完成</option>
        </select>
      </div>
    </div>
    <div class="header-item" data-header-id="completedRange">
      <div class="pill">
        <strong>完成時間</strong>
        <select id="completedRange">
          <option value="">全部</option>
          <option value="7">近7天</option>
          <option value="30">近30天</option>
        </select>
      </div>
    </div>
    <div class="header-item" data-header-id="showUndated">
      <label class="pill" style="gap:8px">
        <input id="showUndated" type="checkbox" checked/>
        <span>顯示未排期</span>
      </label>
    </div>
    <div class="header-item" data-header-id="search">
      <div class="pill">
        <strong>搜尋</strong>
        <input id="searchInput" type="text" placeholder="姓名 / 電話 / 地址" style="width:220px"/>
      </div>
    </div>
    <div class="header-item header-item--action" data-header-id="newOrder">
      <button class="accent" id="newBtn" type="button">新增訂單</button>
    </div>
    <div class="header-item header-item--action" data-header-id="newQuotation">
      <button class="accent" id="openQuotationBtn" type="button" onclick="window.open('https://unclequotation.netlify.app','_blank','noopener')">新增報價單</button>
    </div>
    <div class="header-item header-item--action" data-header-id="newExpense">
      <button id="newExpenseBtn" type="button">新增花費</button>
    </div>
  </div>

  <div class="header-layout-bar">
    <button id="headerLayoutToggle" type="button" class="header-layout-toggle">
      編輯工具列
    </button>
  </div>

  <section id="headerLayoutEditor" class="header-layout-editor" hidden>
    <div class="header-layout-editor__inner">
      <div class="header-layout-editor__title-row">
        <h2>手機工具列布局</h2>
        <button type="button" id="headerLayoutClose" class="header-layout-close">關閉</button>
      </div>
      <p class="header-layout-editor__hint">
        只會影響手機畫面（寬度小於 600px）。可調整顯示順序與寬度（整列 / 半列）。
      </p>
      <div id="headerLayoutList" class="header-layout-list">
        <!-- JS 動態產生每個項目 -->
      </div>
      <div class="header-layout-footer">
        <button type="button" id="headerLayoutReset" class="btn ghost">重設預設布局</button>
        <button type="button" id="headerLayoutSave" class="btn primary">儲存布局</button>
      </div>
    </div>
  </section>
</header>


<main class="wrap stack" style="margin-top:16px">
    <div class="view-tabs">
    <button class="view-tab is-active" type="button" data-view="main">📋 排程</button>
    <button class="view-tab" type="button" data-view="reminder">⏰ 提醒</button>
    <button class="view-tab" type="button" data-view="settings">⚙️ 設定</button>
  </div>


  <div id="mainMode" class="view-panel view-main is-active">
<section class="card">
<div class="card-header" style="display:flex; align-items:center; justify-content:space-between;">
<h2>訂單列表</h2>
<div class="header-actions" style="display:flex; align-items:center; gap:4px; flex-shrink:0;"><select aria-label="統計年份選擇" id="yearStatSelect" style="height:32px; margin-right:12px; padding:4px 8px; font-size:14px; max-width:120px;"></select>
<button aria-controls="yearSummary" aria-expanded="false" class="small-toggle" id="toggleYearBtn" style=" min-width:80px; white-space:nowrap;" title="切換年度統計 (預設收起)">年度統計 ▾</button>
</div>
</div>
<div class="body">
<div class="sum" id="yearSummary" style="padding-top: 4px; margin-bottom: 16px;"></div>
<div class="sum" id="summary"></div>
<div class="hr"></div>
<div style="overflow:auto;margin-top:8px">
<div class="card due-panel" id="dueSoonPanel">
<div class="card-title-row">
  <div class="card-title">快到期提醒（30 天內）</div>
  <button type="button" class="btn btn-reminder" id="btnOpenReminderCenter">前往提醒中心</button>
</div>
<div class="due-stats" id="dueSoonStats">目前沒有需要提醒的客戶</div>
<div class="due-list" id="dueSoonList">目前沒有 30 天內將到期的客戶</div>
</div>
<table id="ordersTable">
<thead>
<tr>
<th>#</th><th>日期</th><th>時間</th><th>作業人員</th><th>客戶</th><th>電話</th><th class="col-slot">時段</th><th>地址</th><th class="col-status">狀況</th><th>確認</th><th>報價單</th><th class="right-align col-total">總金額</th><th class="right-align">折後</th><th>來源</th><th>操作</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
</section>
<details class="accordion" id="orderAccordion"><summary><span id="formTitle">新增 / 編輯訂單</span>
  <button id="toggleLayoutEditBtn" style="font-size:13px;padding:6px 8px;border-radius:6px;margin-left:8px;" type="button">編輯布局</button>
<button id="saveLayoutBtn" style="display:none;font-size:13px;padding:6px 8px;border-radius:6px;margin-left:6px;" type="button">儲存布局</button>
<button id="resetLayoutBtn" style="display:none;font-size:13px;padding:6px 8px;border-radius:6px;margin-left:6px;" type="button">還原預設</button>
</summary><div class="content">
<form id="orderForm">
<input id="id" type="hidden"/>
<details class="order-section" open>
  <summary class="order-section__summary">一、排程與客戶資料</summary>

<div class="row">
<div class="col" style="grid-column:span 6">
<label>作業人員</label>
<div class="toolbar" style="gap:8px">
<select id="staff"><option value="透天屋"></option></select>
<button class="inline-btn" id="addStaffBtn" type="button">新增人員</button>
</div>
</div>
<div class="col" style="grid-column:span 3"><label>日期（可留空，之後再填）</label><input id="date" type="date"/></div>
<div class="col" style="grid-column:span 3"><label>時間</label><input id="time" type="time"/></div>
<div class="col" style="grid-column:span 7"><label>清洗地址</label><input id="address" placeholder="地址" type="text"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6">
<label>姓名（支援通訊錄）</label><input id="customer" list="contactsDL" placeholder="客戶姓名" type="text"/><datalist id="contactsDL"></datalist><div class="tiny">選既有客戶會自動帶出電話/地址</div>
</div>
<div class="col" style="grid-column:span 3">
  <label>LINE or Fackbook ID</label><div id="lineIdContainer"><div class="lineid-row"><input class="lineid-input" id="lineId" type="text"/></div></div><button id="addLineIdBtn" type="button" class="btn-add-id">＋ 新增 ID</button>
</div>
<div class="col" style="grid-column:span 3">
<label>電話</label><div id="phoneContainer"><input class="phone-input" placeholder="輸入電話" type="text"/></div><button id="addPhoneBtn" type="button">＋新增電話</button>
</div>
<div class="col" style="grid-column:span 6">
<label>居住地型態</label>
<div class="toolbar" style="gap:8px">
<select id="residenceType"><option value="">（未選擇）</option><option value="透天屋">透天屋</option><option value="大樓(有電梯)">大樓(有電梯)</option><option value="大樓(無電梯)">大樓(無電梯)</option><option value="其他">其他（可自行輸入）</option></select>
<input class="hidden" id="residenceOther" placeholder="請輸入其他型態" type="text"/>
</div>
</div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label>安排時段（可複選）</label><div class="checkbox-group" id="slotGroup"></div><input class="hidden tiny" id="slotNote" placeholder="請輸入指定日期／時段" type="text"/></div>
<div class="col" style="grid-column:span 6"><label>方便聯繫時間（可複選）</label><div class="checkbox-group" id="contactTimesGroup"></div><input class="hidden tiny" id="contactTimeNote" placeholder="請輸入指定時間" type="text"/></div>
<div class="col" style="grid-column:span 8"><label>與我司聯繫方式</label><div class="toolbar" style="gap:8px"><select id="contactMethod"></select><button class="inline-btn" id="addContactMethod" type="button">新增聯繫方式</button></div></div>
<div class="col" style="grid-column:span 4"><label>狀況</label><select id="status"><option value="排定">排定</option><option value="完成">完成</option><option value="未完成">未完成</option></select></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label>冷氣位於樓層（可複選）</label><div class="checkbox-group" id="acFloors"></div><div class="hidden" id="acFloorAboveWrap"><input id="acFloorAbove" placeholder="請輸入實際樓層（例：6F...）" type="text"/></div></div>
<div class="col" style="grid-column:span 6"><label>洗衣機位於樓層（可複選）</label><div class="checkbox-group" id="washerFloors"></div><div class="hidden" id="washerFloorAboveWrap"><input id="washerFloorAbove" placeholder="請輸入實際樓層（例：6F...）" type="text"/></div></div>
<div class="col" style="grid-column:span 6">
<div class="toolbar" id="reminderToolbar" style="gap:8px; align-items:center; flex-wrap:wrap">
<label class="pill"><input checked="" id="reminderEnabled" type="checkbox"/> <span>啟用提醒</span></label>
<label class="muted">提醒週期（月）</label><input class="tiny compact" id="reminderMonths" min="0" placeholder="例如 12" step="1" type="number" value="24"/>

<label class="pill"><input id="reminderNotified" type="checkbox"/> <span>已通知</span></label>
<label class="pill danger"><input id="reminderMuted" type="checkbox"/> <span>不再提醒</span></label>
</div>
</div>
</div>
</details>

<details class="order-section" open>
  <summary class="order-section__summary">二、清洗項目與備註</summary>
<div class="hr"></div>
<h3 style="margin:0 0 8px">清洗項目與價格</h3>
<div class="row">
<div class="col" style="grid-column:span 6"><label><b><span style="color:red;font-size:15px">分離式冷氣室內機</span></b></label><input id="acSplit" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 6"><label>吊隱式冷氣</label><input id="acDuct" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label><b><span style="color:red;font-size:15px">直立式洗衣機</span></b></label><input id="washerTop" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 6"><label>水塔</label><input id="waterTank" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label>自來水管（自訂金額，未稅總額）</label><input id="pipesAmount" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 6"><label><b><span style="color:red;font-size:15px">防霉噴劑</span></b></label><input id="antiMold" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label>臭氧殺菌</label><input id="ozone" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 6"><label>變形金剛機型</label><input id="transformerCount" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 6"><label>分離式室內機長度 &gt; 182cm</label><input id="longSplitCount" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 6"><label>一體式水盤</label><input id="onePieceTray" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 12"><label>備註</label><textarea id="note" placeholder="其他補充事項"></textarea></div>
</div>
<div class="row">
  <div class="col" style="grid-column:span 12"><label>預約冷氣品牌（可複選）</label><div class="checkbox-group" id="acBrandGroup"></div><input class="hidden tiny" id="acBrandOtherText" placeholder="請輸入其他品牌" type="text"/></div>
</div>
<div class="row" id="photoUrlBlock"><div class="col" style="grid-column:span 6"><label>清洗照片網址（可多筆）</label><div id="photoUrlContainer"></div><div id="photoUrlViewer" style="display:none; margin-top: 4px;"></div><button id="editPhotoUrlsBtn" onclick="enablePhotoUrlEdit()" style="display:none; margin: 6px 0; padding: 6px 12px; border-radius: 6px; border: none; background-color: #28a745; color: white; cursor: pointer;" type="button">✏️ 編輯網址</button><button class="btn btn-blue" id="addPhotoUrlBtn" style="margin-top: 4px; margin-bottom: 4px;" type="button">＋新增網址</button></div></div>
</details>

<details class="order-section" open>
  <summary class="order-section__summary">三、金額與確認</summary>
<div class="hr"></div>
<div class="row">
<div class="col" style="grid-column:span 4"><label class="big-toggle" for="confirmed"><input id="confirmed" name="confirmed" type="checkbox" aria-label="客人確認安排時間" /><span class="big-toggle-text">客人確認安排時間</span></label></div>
<div class="col" style="grid-column:span 4"><label class="big-toggle" for="quotationOk"><input id="quotationOk" name="quotationOk" type="checkbox" aria-label="客人確認報價單" /><span class="big-toggle-text">客人確認報價單</span></label></div>
<div class="col right-align" style="grid-column:span 4"><button class="inline-btn" id="recalc" type="button">重新計算金額</button></div>
</div>
<div class="row">
<div class="col" style="grid-column:span 3"><label>總金額（自動）</label><input id="total" readonly="" type="number"/></div>
<div class="col" style="grid-column:span 3"><label>額外加價（手動輸入）</label><input id="extraCharge" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 3"><label>折扣金額（可輸入）</label><input id="discount" min="0" step="1" type="number" value="0"/></div>
<div class="col" style="grid-column:span 3"><label>折後總金額（自動）</label><input id="netTotal" readonly="" type="number"/></div>
</div>
<div class="hr"></div>
<div class="toolbar">
<button class="primary" id="saveBtn" type="submit">儲存訂單</button>
<button id="resetBtn" type="button">清空表單</button>
<button id="quickNextBtn" type="button">快速新增下一次</button>
<div class="right">
<span class="lock-badge" id="lockInfo"></span>
<div style="display:inline-block; margin-right:8px;"><label style="margin-right:4px;">時長(分)</label><input id="durationMinutes" min="15" placeholder="分鐘" step="15" style="width:80px;" type="number"/></div><button class="btn" onclick="handleUploadWithAuth(gatherForm())">📅</button><button class="warn" id="toggleLock" type="button">解鎖金額編輯</button>
<button class="danger" disabled="" id="deleteBtn" type="button">刪除此訂單</button>
</div>
</div>
</details>

</form>
</div></details>
<details class="accordion" id="expenseAcc">
<summary>本月花費（可展開/收合）</summary>
<div class="content">
<div class="two-col">
<section class="card" style="border:none;box-shadow:none">
<h2>本月花費列表</h2>
<div class="body">
<div class="toolbar" style="margin-bottom:8px">
<button id="expExportCsv">匯出花費CSV</button>
<button id="expExportJson">匯出花費JSON</button>
<button class="warn" id="expImportJson">匯入花費JSON</button>
<button class="danger" id="expClear">清空花費</button>
</div>
<div style="overflow:auto">
<table id="expenseTable"><thead><tr><th>#</th><th>日期</th><th>類別</th><th>說明</th><th class="right-align">金額</th></tr></thead><tbody></tbody></table>
</div>
</div>
</section>
<aside class="card" style="border:none;box-shadow:none">
<h2>新增 / 編輯花費</h2>
<div class="body">
<form id="expenseForm">
<input id="expId" type="hidden"/>
<div class="row">
<div class="col" style="grid-column:span 4"><label>日期</label><input id="expDate" type="date"/></div>
<div class="col" style="grid-column:span 4"><label>類別</label><div class="toolbar" style="gap:8px"><select id="expCategory"></select><button class="inline-btn" id="addExpCat" type="button">新增類別</button></div></div>
<div class="col" style="grid-column:span 4"><label>金額</label><input id="expAmount" min="0" step="1" type="number" value="0"/></div>
</div>
<div class="row"><div class="col" style="grid-column:span 12"><label>說明</label><input id="expNote" placeholder="例如：材料、加油..." type="text"/></div></div>
<div class="toolbar"><button class="primary" id="expSave" type="submit">儲存花費</button><button id="expReset" type="button">清空表單</button><div class="right"><button class="danger" disabled="" id="expDelete" type="button">刪除此筆花費</button></div></div>
</form>
</div>
</aside>
</div>
</div>
</details>
</div>

<section id="reminderCenterSection" class="card view-panel view-reminder" style="display:none">
  <div class="card-header" style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
    <h2>提醒中心</h2>
    <div class="header-actions" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
      <div class="pill"><strong>顯示範圍</strong><select id="reminderRange"><option value="overdue">僅逾期</option><option value="7">7 天內</option><option value="30" selected>30 天內</option><option value="60">60 天內</option><option value="all">全部未來</option></select></div>
      <div class="pill"><strong>作業人員</strong><select id="reminderStaffFilter"><option value="">全部</option></select></div>
      <div class="pill pill-search"><strong>搜尋</strong><input id="reminderSearch" type="search" placeholder="姓名 / 電話 / 地址"/></div>
      <label class="pill"><input id="reminderOnlyUnnotified" type="checkbox" checked/><span>只看尚未通知</span></label>
      <label class="pill"><input id="reminderShowMuted" type="checkbox"/><span>顯示靜音客戶</span></label>
      <button type="button" class="btn btn-reminder" id="btnOpenIgnoreManager" title="管理忽略清單">管理忽略名單</button>
    </div>
  </div>
  <div class="body">
    <div id="reminderStats" class="muted" style="margin-bottom:8px;font-size:14px;">目前沒有提醒資料。</div>
    <div class="hr"></div>
    <div id="reminderList" class="reminder-center-list"></div>
  </div>
</section>

  <section id="settingsPanel" class="card view-panel view-settings" style="display:none">
    <div class="card-header">
      <h2>系統設定</h2>
    </div>
    <div class="body settings-grid">
      <section class="settings-group">
        <h3>價格設定</h3>
        <p>管理冷氣 / 洗衣機等項目的預設價格。</p>
        <button class="accent" id="openPricingBtn" type="button">💰價格設定</button>
      </section>

      <section class="settings-group">
        <h3>匯出 / 匯入</h3>
        <p>備份或還原本機資料（JSON）。</p>
        <div class="settings-actions">
          <button id="exportJson" type="button">匯出 JSON</button>
          <button class="warn" id="importJson" type="button">匯入 JSON</button>
          <button class="danger" id="clearAll" type="button">清空全部資料</button>
        </div>
      </section>

      <section class="settings-group">
        <h3>雲端備份</h3>
        <p>使用 Google Drive 備份與還原資料。</p>
        <button class="accent" id="gdriveBackupBtn" type="button" onclick="initGoogleBackup()">☁️ Google 備份 / 還原</button>
      </section>
    </div>
  </section>
</main>
<input accept=".json" class="hidden" id="filePicker" type="file"/>
<input accept=".json" class="hidden" id="filePickerExp" type="file"/>
<script src="https://apis.google.com/js/api.js"></script>
<script async="" defer="" src="https://accounts.google.com/gsi/client"></script>
<script defer src="app.core.js"></script>
<script defer src="app.reminder.js"></script>
<script defer src="app.pricing.js"></script>
<script defer src="app.form.js"></script>
<script defer src="app.table.js"></script>
<script defer src="app.expense.js"></script>
<script defer src="app.views.js"></script>
<script defer src="app.google.js"></script>
<script defer src="app.js"></script>

<div aria-hidden="true" class="modal" id="pricingModal">
  <div class="modal-backdrop" data-close="true"></div>
  <div class="modal-panel" style="max-width:600px;">
    <header class="modal-header">
      <h3>價格設定 (修改後僅影響新計算)</h3>
      <button aria-label="關閉" class="btn-small" id="pricingCloseBtn">✕</button>
    </header>
    <div class="modal-body" style="padding:16px;">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
        <div>
          <h4 style="margin:0 0 8px;border-bottom:1px solid #eee;padding-bottom:4px">分離式冷氣</h4>
          <label>每台單價 <input id="price_acSplit_unit" type="number" class="form-input"></label>
          <label>滿3台單價 <input id="price_acSplit_bulk3plus" type="number" class="form-input"></label>
          <label>長度>182cm 加價 <input id="price_longSplitCount_unit" type="number" class="form-input"></label>
        </div>
        <div>
          <h4 style="margin:0 0 8px;border-bottom:1px solid #eee;padding-bottom:4px">吊隱式冷氣</h4>
          <label>每台單價 <input id="price_acDuct_unit" type="number" class="form-input"></label>
        </div>
        <div>
          <h4 style="margin:0 0 8px;border-bottom:1px solid #eee;padding-bottom:4px">直立式洗衣機</h4>
          <label>含冷氣(合購)單價 <input id="price_washerTop_withAC" type="number" class="form-input"></label>
          <label>不含冷氣單價 <input id="price_washerTop_withoutAC" type="number" class="form-input"></label>
        </div>
        <div>
           <h4 style="margin:0 0 8px;border-bottom:1px solid #eee;padding-bottom:4px">其他項目</h4>
           <label>水塔 (每顆) <input id="price_waterTank_unit" type="number" class="form-input"></label>
           <label>臭氧殺菌 (每間) <input id="price_ozone_unit" type="number" class="form-input"></label>
           <label>變形金剛 (每台) <input id="price_transformerCount_unit" type="number" class="form-input"></label>
           <label>一體式水盤 (每台) <input id="price_onePieceTray_unit" type="number" class="form-input"></label>
        </div>
        <div style="grid-column: span 2;">
           <h4 style="margin:0 0 8px;border-bottom:1px solid #eee;padding-bottom:4px">防霉噴劑</h4>
           <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
             <label>每台單價 <input id="price_antiMold_unit" type="number" class="form-input"></label>
             <label>滿5台單價 <input id="price_antiMold_bulk5plus" type="number" class="form-input"></label>
           </div>
        </div>
      </div>
    </div>
    <footer class="modal-footer" style="padding:16px; display:flex; justify-content:flex-end; gap:10px;">
      <button class="btn danger" id="resetPricingBtn">恢復預設值</button>
      <button class="btn primary" id="savePricingBtn">儲存設定</button>
    </footer>
  </div>
</div>

<div aria-hidden="true" class="modal input-modal" id="inputModal">
  <div class="modal-backdrop" data-close="true"></div>
  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="inputModalTitle">
    <header class="modal-header">
      <h3 id="inputModalTitle">輸入內容</h3>
      <button aria-label="關閉" class="btn-small" id="inputModalCloseBtn">✕</button>
    </header>
    <div class="modal-body">
      <label id="inputModalLabel" class="muted small"></label>
      <input id="inputModalInput" class="form-input" type="text" />
    </div>
    <footer class="modal-footer">
      <button class="btn" id="inputModalConfirm">確定</button>
      <button class="btn btn-ghost" id="inputModalCancel">取消</button>
    </footer>
  </div>
</div>
<div aria-hidden="true" class="modal" id="historyModal">
<div class="modal-backdrop" data-close="true"></div>
<div class="modal-panel">
<header class="modal-header">
<h3 id="historyModalTitle">客戶歷史紀錄</h3>
<button aria-label="關閉" class="btn-small" id="historyCloseBtn">✕</button>
</header>
<section class="modal-body">
<div class="history-controls">
<input id="historySearch" placeholder="搜尋清洗項目或備註..."/>
<button class="btn-small" id="historyExportCsv">匯出 CSV</button>
<select id="historySort"><option value="desc">依時間（新→舊）</option><option value="asc">依時間（舊→新）</option></select>
</div>
<div class="history-table-wrap">
<table class="table" id="historyTable"><thead><tr><th>姓名</th><th>清洗時間</th><th>電話</th><th>清洗項目</th><th>地址</th><th>備註</th><th>操作</th></tr></thead><tbody id="historyTableBody"></tbody></table>
<div id="historyEmpty" style="display:none">目前沒有歷史紀錄</div>
</div>
</section>
</div>
</div>
<script>
(function(){
  try {
    const labels = document.querySelectorAll('.big-toggle');
    labels.forEach(label => {
      const input = label.querySelector('input[type="checkbox"]');
      if (!input) return;
      const sync = () => label.classList.toggle('checked', !!input.checked);
      sync();
      input.addEventListener('change', sync);
      const observer = new MutationObserver(sync);
      observer.observe(input, { attributes: true, attributeFilter: ['checked'] });
    });
  } catch(e){ console.warn('big-toggle sync failed', e); }
})();
</script>
<div aria-hidden="true" class="modal" id="ignoreManagerModal">
  <div class="modal-backdrop" data-close="true"></div>
  <div class="modal-panel" style="max-width:1000px; max-height:80vh; overflow:auto;">
    <header class="modal-header">
      <h3>忽略清單管理</h3>
      <button aria-label="關閉" class="btn-small" id="ignoreCloseBtn">✕</button>
    </header>
    <section class="modal-body">
      <div class="ignore-toolbar">
        <input id="ignoreManagerSearch" class="ignore-search-input" placeholder="搜尋 ID / 姓名 / 電話 / 地址"/>
        <div class="ignore-toolbar__actions">
          <button id="ignoreExportBtn" class="btn-small">匯出 CSV</button>
          <button id="ignoreUnignoreSelected" class="btn-small">取消忽略選取</button>
          <button id="ignoreClearBtn" class="btn-small danger">清空所有</button>
        </div>
      </div>
      <div class="ignore-table-wrapper" style="overflow:auto; max-height:60vh;">
<table  id="ignoreManagerTable" class="ignore-manager-table" class="table" style="width:100%; border-collapse:collapse;">
          <thead><tr><th style="width:36px; text-align:center;"><input type="checkbox" id="ignoreSelectAll"/></th><th class="no-wrap">日期</th><th class="no-wrap">姓名</th><th class="no-wrap">電話</th><th>地址</th><th class="no-wrap">操作</th></tr></thead><tbody></tbody>
        </table>
      </div>
    </section>
  </div>
</div>
<div id="genericConfirmModal" class="confirm-modal" aria-hidden="true" role="dialog">
  <div class="confirm-panel">
    <h3 id="genericConfirmTitle">確認</h3>
    <div id="genericConfirmMessage" class="confirm-message"></div>
    <div class="confirm-actions">
      <button id="genericConfirmCancel" class="btn btn-secondary">取消</button>
      <button id="genericConfirmOk" class="btn btn-danger">確定</button>
    </div>
  </div>
</div>
<div id="genericAlertModal" class="confirm-modal" aria-hidden="true" role="alertdialog">
  <div class="confirm-panel">
    <h3 id="genericAlertTitle">提示</h3>
    <div id="genericAlertMessage" class="confirm-message"></div>
    <div class="confirm-actions">
      <button id="genericAlertOk" class="btn btn-primary">確定</button>
    </div>
  </div>
</div>
</body>
</html>